<%# Renders a single event preview card for the discover view %>
<div class="event-card-v2 mb-4 card shadow-sm">
  <%= link_to event_path(event), class: "event-card-link-wrapper text-decoration-none text-dark" do %>
    <%# Hero Image %>
    <div class="event-image-wrapper">
      <% if event.hero_image.attached? %>
        <%= cl_image_tag event.hero_image.key, class: "event-hero-image", crop: :fill %>
      <% else %>
        <div class="placeholder-box text-center py-5" style="height: 180px; background-color: #f0f0f0;">
          <i class="fa-regular fa-image fa-2x text-muted"></i>
        </div>
      <% end %>
    </div>

    <div class="card-body">
      <h3 class="event-title"><%= event.title.presence || "Untitled Event" %></h3>

      <%# Time and Location (e.g., Today 10pm - PARIS) %>
      <p class="event-time-location">
        <strong><%= event.display_time_and_location %></strong>
      </p>

      <%# Description Preview %>
      <p class="event-description-preview text-muted">
        <%= truncate(event.description, length: 70) %>
      </p>
    </div>
  <% end %>

  <%# Action Row (Save and Share) - Outside the link_to for clickability %>
  <div class="event-actions d-flex justify-content-between align-items-center px-4 pb-3">
    <% if current_user %>
      <% saved = event.saved_by?(current_user) %>
      <%# Star/Save Button (Interested) - Assuming Rails UJS/Turbo handles the POST/DELETE %>
      <%= link_to reactions_path(reaction: { reactable_type: 'Event', reactable_id: event.id, reaction_type: 'save' }),
          method: saved ? :delete : :post,
          class: "event-save-btn text-decoration-none",
          data: { turbo_method: saved ? :delete : :post } do %>
        <i class="<%= saved ? 'fa-solid' : 'fa-regular' %> fa-star star-icon <%= 'text-warning' if saved %>"></i>
        <span class="save-text <%= 'interested-text' if saved %>">Interested</span>
      <% end %>
    <% else %>
      <%# Non-logged-in state %>
      <span class="event-save-btn text-muted"><i class="fa-regular fa-star star-icon"></i> Interested</span>
    <% end %>

    <%# Share Button (Arrow Icon) %>
    <%= link_to "#", data: { bs_toggle: "modal", bs_target: "#shareModal_#{event.id}" }, class: "event-share-btn text-muted" do %>
      <i class="fa-solid fa-share arrow-icon"></i>
    <% end %>
  </div>
</div>
