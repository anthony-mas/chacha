<%= simple_form_for(@event, data: { controller: "event-form" }) do |f| %>
  <%= f.error_notification %>

  <div data-controller="hero-library">

    <div class="hero-preview-area" data-hero-library-target="preview">
      <% if @event.hero_image.attached? %>
        <%= image_tag @event.hero_image, class: "hero-image-preview" %>
      <% end %>
    </div>

    <%= f.hidden_field :hero_image_choice,
                       data: { "hero-library-target": "input" } %>

    <button type="button"
            class="btn-secondary"
            data-action="hero-library#open">
      Choose from library
    </button>

    <%= render "events/hero_library_modal" %>
  </div>


  <%= f.input :title %>

  <%= f.input :description, as: :text, input_html: { rows: 8 } %>

  <%= f.input :category_ids,
              collection: @categories,
              as: :select,
              label: "Category",
              input_html: { multiple: false, class: "form-select" } %>

<div data-controller="mapbox-autocomplete"
     data-mapbox-autocomplete-api-key-value="<%= ENV['MAPBOX_ACCESS_TOKEN'] %>">

  <%= f.label :location, "Location", class: "tight-label" %>

  <%= f.input_field :location,
        class: "hidden-location-input",
        data: { "mapbox-autocomplete-target": "input" } %>

  <div class="mapbox-geocoder-container"
       data-mapbox-autocomplete-target="container"></div>



  <!-- Mapbox search UI will appear here -->
  <div class="mapbox-geocoder-container"
       data-mapbox-autocomplete-target="container"></div>

</div>

  <%= f.input :starts_on,
              as: :datetime,
              html5: true,
              input_html: {
                value: f.object.starts_on || Time.now.change(min: 0, sec: 0) + 1.hour,
                data: {
                  "event-form-target": "startsOn",
                  action: "change->event-form#updateEndsOn"
                }
              },
              wrapper_html: {
                class: "my-3"
              } %>


  <%= f.input :ends_on,
              as: :datetime,
              html5: true,
              input_html: {
                value: f.object.ends_on || Time.now.change(min: 0, sec: 0) + 2.hours,
                data: { "event-form-target": "EndsOn" }
              } %>


  <div class="settings-card">
    <h3>Privacy</h3>
    <div class="toggle-wrapper">
    </div>
    <div class="form-check form-switch">
      <%= f.input_field :event_private, as: :boolean, label: "Private event ?", class: "form-check-input", id: "switchCheckDefault" %>
      <label class="form-check-label" for="switchCheckDefault">Private event ?</label>
    </div>
  </div>

<div class="settings-card">
  <h3>Discoverability</h3>

  <div class="form-check form-switch">
    <%= check_box_tag :discoverable,
          "1",
          false,
          class: "form-check-input",
          id: "switchDiscoverable" %>

    <label class="form-check-label" for="switchDiscoverable">
      Make this event discoverable
    </label>
  </div>

  <p class="settings-hint">
    (Placeholder – not yet connected to the database.)
  </p>
</div>


<div class="settings-card">
  <h3>Guests</h3>

  <div class="form-check form-switch">
    <%= check_box_tag :require_guest_approval,
          "1",
          false,
          class: "form-check-input",
          id: "switchGuestApproval" %>

    <label class="form-check-label" for="switchGuestApproval">
      Require host approval for new guests
    </label>
  </div>

  <p class="settings-hint">
    (Placeholder – participation logic coming later.)
  </p>
</div>


  <div>
    <%= f.button :submit, "Create Event", class: "btn-primary" %>
  </div>

<% end %>
