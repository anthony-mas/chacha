<%# Event Guest List (Screenshot 1: Avatars, Count, View All button) %>

<%# Calculate total guests and determine which avatars to display %>
<% participants = event.participations.includes(:user).order("users.name ASC") %>
<% total_guests = participants.sum(:extra_guests) + participants.count %>
<% displayed_avatars = participants.first(6) %>
<% remaining_guests_count = participants.count > 6 ? participants.count - 6 : 0 %>

<div class="guests-list-container">
  <div class="guests-header">
    <h2 class="title-md"><strong>Guest List</strong></h2>
    <%# The data-action triggers the modal via the 'modal' Stimulus controller %>
    <%= link_to "View all", "#", class: "btn-view-all", data: { action: "click->modal#open", modal_id: "manage-guests-modal" } %>
  </div>

  <p class="guest-count"><%= total_guests %> Guests Attending</p>

  <div class="guest-avatars-scroll">
    <% displayed_avatars.each do |participation| %>
      <div class="guest-card">
        <%# Generate a color based on user email for a unique placeholder avatar %>
        <div class="guest-avatar" style="background-color: #<%= Digest::MD5.hexdigest(participation.user.email)[0..5] %>;">
          <%= participation.user.name.first.upcase %>
        </div>
        <span class="guest-name"><%= participation.user.name.split.first %></span>
      </div>
    <% end %>

    <% if remaining_guests_count > 0 %>
      <div class="guest-card">
        <div class="guest-avatar guest-overflow">
          +<%= remaining_guests_count %>
        </div>
      </div>
    <% end %>
  </div>
</div>
