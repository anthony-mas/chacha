<div class="event-page">

  <div class="event-card-detail">

    <div class="event-hero-image placeholder-box">
      <span class="placeholder-icon">ğŸ–¼ï¸</span>
    </div>

    <div class="event-content-wrapper">

      <header class="event-header">
        <h1 class="centered-title"><%= @event.title.presence ||
"Event" %></h1>

        <div class="event-metadata">
          <p>
            <strong>Date:</strong>
            <%= @event.starts_on %>
            <% if @event.ends_on.present? && @event.ends_on != @event.starts_on %>
              â€“ <%= @event.ends_on %>
            <% end %>
          </p>
          <p>
            <strong>Location:</strong> <%= @event.location %>
          </p>
          <p>
            <strong>Private:</strong> <%= @event.event_private ? "Yes" : "No" %>
          </p>
        </div>
      </header>

      <% if user_signed_in? && @event.user == current_user %>
        <section class="event-host-tools">
          <h2>Host tools</h2>

          <p>
            <%= link_to "Edit event", edit_event_path(@event) %> |
<%= link_to "Delete", @event, data: { turbo_method: :delete, turbo_confirm: "Are you sure?"
} %>
          </p>

          <div class="host-actions-buttons">
            <button type="button" class="btn btn-action-large btn-send-blast" disabled>
              <i class="fa-solid fa-bullhorn"></i>
              Send a blast
            </button>
            <button type="button" class="btn btn-action-large btn-invite-guests" data-action="click->modal#open">
              <i class="fa-solid fa-share-from-square"></i>
              Invite Guests
            </button>
          </div>
        </section>
      <% end %>

      <section class="event-rsvp">
        <h2>Are you going?</h2>
        <div class="rsvp-emoji-row">
          <button type="button" class="rsvp-emoji-trigger" data-rsvp-status="going">ğŸ‘</button>
          <button type="button" class="rsvp-emoji-trigger" data-rsvp-status="maybe">ğŸ¤”</button>
          <button type="button" class="rsvp-emoji-trigger" data-rsvp-status="not_going">ğŸ‘</button>
        </div>
      </section>

      <%= render "rsvp_modal" %>

      <section class="event-description">
        <h2>About this event</h2>
        <p><%= @event.description.presence ||
"No description yet." %></p>
      </section>

      <section class="event-main-layout">
        <div class="event-guests-panel">
          <h2>Guests</h2>
          <p>
            Guest list and RSVP statuses will appear here.
This will be powered by participations later.
          </p>
        </div>

        <div class="event-activity-panel">
          <h2>Activity</h2>
          <p>
            Activity feed (posts, comments, reactions) will appear here.
This will be powered by posts/comments/reactions later.
          </p>
        </div>
      </section>

      <p>
        <%= link_to "Back to my events", events_path %>
      </p>

    </div>
  </div>
</div>

<%= render "events/share_modal" %>

<script>
(function() {
  const overlay = document.querySelector('.rsvp-modal-overlay');
  const modal = document.querySelector('.rsvp-modal');
  const closeBtn = document.querySelector('.rsvp-modal-close');
  const triggers = document.querySelectorAll('.rsvp-emoji-trigger');
  const modalEmojis = document.querySelectorAll('.rsvp-emoji-choice');

  function openModal(status) {
    overlay.classList.remove('is-hidden');
    document.body.style.overflow = 'hidden';
    // Highlight the selected emoji in the modal
    modalEmojis.forEach(btn => {
      btn.classList.toggle('selected', btn.dataset.rsvpStatus === status);
    });
  }

  function closeModal() {
    overlay.classList.add('is-hidden');
    document.body.style.overflow = '';
  }

  // Open modal when clicking emoji triggers on the page
  triggers.forEach(btn => {
    btn.addEventListener('click', () => openModal(btn.dataset.rsvpStatus));
  });

  // Close modal when clicking the close button
  if (closeBtn) {
    closeBtn.addEventListener('click', closeModal);
  }

  // Close modal when clicking backdrop (but not the modal card itself)
  if (overlay) {
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) {
        closeModal();
      }
    });
  }

  // Allow emoji selection inside the modal
  modalEmojis.forEach(btn => {
    btn.addEventListener('click', () => {
      modalEmojis.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    });
  });
})();
</script>
