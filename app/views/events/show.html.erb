<div class="event-page">

  <div class="event-card-detail">

    <div class="event-hero-image placeholder-box">
      <span class="placeholder-icon">üñºÔ∏è</span>
    </div>

    <div class="event-content-wrapper">

      <header class="event-header">
        <h1 class="centered-title"><%= @event.title.presence ||
"Event" %></h1>

        <div class="event-metadata">
          <p>
            <strong>Date:</strong>
            <%= @event.starts_on %>
            <% if @event.ends_on.present? && @event.ends_on != @event.starts_on %>
              ‚Äì <%= @event.ends_on %>
            <% end %>
          </p>
          <p>
            <strong>Location:</strong> <%= @event.location %>
          </p>
          <p>
            <strong>Private:</strong> <%= @event.event_private ? "Yes" : "No" %>
          </p>
        </div>
      </header>

      <% if user_signed_in? && @event.user == current_user %>
        <section class="event-host-tools">
          <h2>Host tools</h2>

          <p>
            <%= link_to "Edit event", edit_event_path(@event) %> |
<%= link_to "Delete", @event, data: { turbo_method: :delete, turbo_confirm: "Are you sure?"
} %>
          </p>

          <div class="host-actions-buttons">
            <button type="button" class="btn btn-action-large btn-send-blast" disabled>
              <i class="fa-solid fa-bullhorn"></i>
              Send a blast
            </button>
            <%# CRITICAL FIX: Explicitly target share-modal ID %>
            <button type="button" class="btn btn-action-large btn-invite-guests" data-action="click->modal#open" data-modal-id="share-modal">
              <i class="fa-solid fa-share-from-square"></i>
              Invite Guests
            </button>
          </div>
        </section>
      <% end %>

      <section class="event-rsvp">
        <h2>Are you going?</h2>
        <div class="rsvp-emoji-row">
          <button type="button" class="rsvp-emoji-trigger" data-rsvp-status="going">üëç</button>
          <button type="button" class="rsvp-emoji-trigger" data-rsvp-status="maybe">ü§î</button>
          <button type="button" class="rsvp-emoji-trigger" data-rsvp-status="not_going">üëé</button>
        </div>
      </section>

      <%= render "rsvp_modal" %>

      <section class="event-description">
        <h2>About this event</h2>
        <p><%= @event.description.presence ||
"No description yet." %></p>
      </section>

      <section class="event-main-layout">
        <div class="event-guests-panel">
          <%= render "guests_list", event: @event %>
        </div>

        <div class="event-activity-panel">
          <h2>Activity</h2>
          <p>
            Activity feed (posts, comments, reactions) will appear here.
This will be powered by posts/comments/reactions later.
          </p>
        </div>
      </section>

      <p>
        <%= link_to "Back to my events", events_path %>
      </p>

    </div>
  </div>
</div>

<%= render "events/share_modal" %>
<%= render "events/manage_guests_modal", event: @event %>

<script>
(function() {
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // RSVP Modal
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const rsvpOverlay = document.querySelector('.rsvp-modal-overlay:not(.manage-guests-overlay)');
  const rsvpCloseBtn = rsvpOverlay ? rsvpOverlay.querySelector('.rsvp-modal-close') : null;
  const rsvpTriggers = document.querySelectorAll('.rsvp-emoji-trigger');
  const rsvpModalEmojis = rsvpOverlay ? rsvpOverlay.querySelectorAll('.rsvp-emoji-choice') : [];

  function openRsvpModal(status) {
    if (!rsvpOverlay) return;
    rsvpOverlay.classList.remove('is-hidden');
    document.body.style.overflow = 'hidden';
    rsvpModalEmojis.forEach(btn => {
      btn.classList.toggle('selected', btn.dataset.rsvpStatus === status);
    });
  }

  function closeRsvpModal() {
    if (!rsvpOverlay) return;
    rsvpOverlay.classList.add('is-hidden');
    document.body.style.overflow = '';
  }

  rsvpTriggers.forEach(btn => {
    btn.addEventListener('click', () => openRsvpModal(btn.dataset.rsvpStatus));
  });

  if (rsvpCloseBtn) {
    rsvpCloseBtn.addEventListener('click', closeRsvpModal);
  }

  if (rsvpOverlay) {
    rsvpOverlay.addEventListener('click', (e) => {
      if (e.target === rsvpOverlay) closeRsvpModal();
    });
  }

  rsvpModalEmojis.forEach(btn => {
    btn.addEventListener('click', () => {
      rsvpModalEmojis.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    });
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Manage Guests Modal
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const guestsOverlay = document.querySelector('.manage-guests-overlay');
  const guestsCloseBtn = guestsOverlay ? guestsOverlay.querySelector('.manage-guests-close') : null;
  const guestsTriggers = document.querySelectorAll('.manage-guests-trigger');
  const statusTabs = guestsOverlay ? guestsOverlay.querySelectorAll('.status-tab') : [];

  function openGuestsModal() {
    if (!guestsOverlay) return;
    guestsOverlay.classList.remove('is-hidden');
    document.body.style.overflow = 'hidden';
  }

  function closeGuestsModal() {
    if (!guestsOverlay) return;
    guestsOverlay.classList.add('is-hidden');
    document.body.style.overflow = '';
  }

  guestsTriggers.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      openGuestsModal();
    });
  });

  if (guestsCloseBtn) {
    guestsCloseBtn.addEventListener('click', closeGuestsModal);
  }

  if (guestsOverlay) {
    guestsOverlay.addEventListener('click', (e) => {
      if (e.target === guestsOverlay) closeGuestsModal();
    });
  }

  // Status tab selection (visual only for now)
  statusTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      statusTabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
    });
  });
})();
</script>
