<%# Share Modal - Bottom sheet style like Apple Invites %>

<% share_url = event_url(@event) %>
<% share_title = @event.title.presence || "Event" %>
<% share_text = "You're invited to #{share_title}! Join here: #{share_url}" %>
<% encoded_text = ERB::Util.url_encode(share_text) %>

<div class="share-modal-backdrop" id="share-modal">
  <div class="share-modal-content">

    <%# Drag Handle %>
    <div class="share-modal-handle"></div>

    <%# Close Button %>
    <button type="button" class="share-modal-close-btn" aria-label="Close">&times;</button>

    <%# Event Preview Card %>
    <div class="share-event-preview">
      <% if @event.hero_image.attached? %>
        <%= image_tag @event.hero_image, class: "share-preview-image" %>
      <% else %>
        <div class="share-preview-image placeholder-box">
          <span class="placeholder-icon">üñºÔ∏è</span>
        </div>
      <% end %>
      <div class="share-preview-info">
        <h3 class="share-event-title"><%= share_title %></h3>
        <p class="share-event-date"><%= @event.starts_on&.strftime("%a, %b %d at %l:%M %p") %></p>
        <p class="share-event-location"><%= @event.location %></p>
      </div>
    </div>

    <%# Share Options %>
    <div class="share-options">
      <h4 class="share-section-title">Share via</h4>

      <div class="share-buttons-row">
        <%# WhatsApp %>
        <a href="https://wa.me/?text=<%= encoded_text %>" target="_blank" rel="noopener" class="share-option-btn">
          <span class="share-icon share-icon-whatsapp">
            <i class="fa-brands fa-whatsapp"></i>
          </span>
          <span class="share-option-label">WhatsApp</span>
        </a>

        <%# Messages / SMS %>
        <a href="sms:&body=<%= encoded_text %>" class="share-option-btn">
          <span class="share-icon share-icon-messages">
            <i class="fa-solid fa-comment"></i>
          </span>
          <span class="share-option-label">Messages</span>
        </a>

        <%# Email %>
        <a href="mailto:?subject=<%= ERB::Util.url_encode("You're invited: " + share_title) %>&body=<%= encoded_text %>" class="share-option-btn">
          <span class="share-icon share-icon-email">
            <i class="fa-solid fa-envelope"></i>
          </span>
          <span class="share-option-label">Email</span>
        </a>

        <%# Copy Link %>
        <button type="button" class="share-option-btn share-copy-btn" data-share-url="<%= share_url %>">
          <span class="share-icon share-icon-copy">
            <i class="fa-solid fa-link"></i>
          </span>
          <span class="share-option-label">Copy Link</span>
        </button>
      </div>

      <%# Native Share Button (shown only if navigator.share is supported) %>
      <button type="button" class="share-native-btn" data-share-url="<%= share_url %>" data-share-title="<%= share_title %>" data-share-text="You're invited to <%= share_title %>!">
        <i class="fa-solid fa-arrow-up-from-bracket"></i>
        <span>More sharing options...</span>
      </button>
    </div>

    <%# Event Link Display %>
    <div class="share-link-section">
      <h4 class="share-section-title">Event Link</h4>
      <div class="share-link-box">
        <input type="text" readonly value="<%= share_url %>" class="share-link-input" id="share-link-input">
        <button type="button" class="share-link-copy-btn" data-share-url="<%= share_url %>">
          <i class="fa-solid fa-copy"></i>
        </button>
      </div>
      <p class="share-copied-feedback" id="share-copied-feedback">Copied to clipboard!</p>
    </div>

  </div>
</div>
